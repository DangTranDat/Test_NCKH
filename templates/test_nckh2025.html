<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá th·ªëng c·∫£nh b√°o l≈© l·ª•t & s·∫°t l·ªü ƒë·∫•t</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f4f6f8;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
        }

        .chart-container {
            width: 95%;
            max-width: 900px;
            margin: 20px auto;
            background-color: #fff;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .alerts {
            max-width: 900px;
            margin: 20px auto;
            background-color: #ffe0e0;
            padding: 16px;
            border-radius: 10px;
            color: #c0392b;
            font-weight: bold;
        }

        .alert-item {
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <h1>H·ªá th·ªëng gi√°m s√°t c·∫£nh b√°o l≈© l·ª•t v√† s·∫°t l·ªü ƒë·∫•t</h1>

    <div class="alerts" id="alertBox">
        <!-- Th√¥ng b√°o m∆∞a, rung s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y -->
    </div>

    <div class="chart-container">
        <canvas id="tempHumChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="waterLevelChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="pressureAltitudeChart"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="gyroChart"></canvas>
    </div>

    <script>
        fetch('/data')
            .then(response => response.json())
            .then(data => {
                const labels = data.timestamps;

                // Th√¥ng b√°o c·∫£nh b√°o
                const alertBox = document.getElementById("alertBox");
                const lastRain = data.rains[data.rains.length - 1];
                const lastVibration = data.vibrations[data.vibrations.length - 1];

                let alerts = "";

                if (lastRain === 1) {
                    alerts += `<div class="alert-item">üåßÔ∏è C·∫¢NH B√ÅO: Ph√°t hi·ªán c√≥ m∆∞a!</div>`;
                }
                if (lastVibration === 1) {
                    alerts += `<div class="alert-item">‚ö†Ô∏è C·∫¢NH B√ÅO: Ph√°t hi·ªán rung ch·∫•n b·∫•t th∆∞·ªùng!</div>`;
                }

                if (alerts === "") {
                    alerts = "<div>‚úÖ Kh√¥ng c√≥ c·∫£nh b√°o n√†o g·∫ßn ƒë√¢y.</div>";
                }

                alertBox.innerHTML = alerts;

                // Temperature & Humidity Chart
                new Chart(document.getElementById('tempHumChart'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Nhi·ªát ƒë·ªô (¬∞C)',
                                data: data.temperatures,
                                borderColor: 'red',
                                fill: false
                            },
                            {
                                label: 'ƒê·ªô ·∫©m (%)',
                                data: data.humidities,
                                borderColor: 'blue',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Nhi·ªát ƒë·ªô v√† ƒê·ªô ·∫©m'
                            }
                        }
                    }
                });

                // Water Level Chart
                new Chart(document.getElementById('waterLevelChart'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'M·ª±c n∆∞·ªõc (cm)',
                                data: data.water_levels,
                                borderColor: 'teal',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'M·ª±c n∆∞·ªõc ƒëo ƒë∆∞·ª£c'
                            }
                        }
                    }
                });

                // Pressure & Altitude Chart
                new Chart(document.getElementById('pressureAltitudeChart'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: '√Åp su·∫•t (hPa)',
                                data: data.pressures,
                                borderColor: 'orange',
                                fill: false
                            },
                            {
                                label: 'ƒê·ªô cao (m)',
                                data: data.altitudes,
                                borderColor: 'green',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: '√Åp su·∫•t kh√¥ng kh√≠ v√† ƒê·ªô cao'
                            }
                        }
                    }
                });

                // Gyroscope (MPU6050)
                new Chart(document.getElementById('gyroChart'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Gyro X (¬∞/s)',
                                data: data.gyro_xs,
                                borderColor: 'purple',
                                fill: false
                            },
                            {
                                label: 'Gyro Y (¬∞/s)',
                                data: data.gyro_ys,
                                borderColor: 'brown',
                                fill: false
                            },
                            {
                                label: 'Gyro Z (¬∞/s)',
                                data: data.gyro_zs,
                                borderColor: 'gray',
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'C·∫£m bi·∫øn con quay (Gyroscope)'
                            }
                        }
                    }
                });
            });
    </script>
</body>
</html>
